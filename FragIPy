# Calculating fragility index: trial results are arranged in a two-by-two contingency table
# an event is iteratively added to the group with the smaller number of events 
# although removing a nonevent from the same group to maintain the total group size
# until the p value produced by Fisher exact test equaled or exceeded 0.05
# The number of events added to reach this threshold is the Fragility Index

frag_ind = 0

#intervention group / top row
int_end = 24
int_no_end = 1849

#controllgroup / bottom row
cont_end = 43
cont_no_end = 1830

table = [[int_end, int_no_end], [cont_end, cont_no_end]]

oddsratio, pvalue = stats.fisher_exact(table)
print("Initial p-value: ", pvalue)

if int_end > cont_end: 
    while pvalue < 0.05 :
        cont_end += 1
        cont_no_end -= 1
        frag_ind +=1
        oddsratio, pvalue = stats.fisher_exact([[int_end, int_no_end], [cont_end, cont_no_end]])

else :
    while pvalue < 0.05 :
        int_end += 1
        int_no_end -= 1
        frag_ind +=1
        oddsratio, pvalue = stats.fisher_exact([[int_end, int_no_end], [cont_end, cont_no_end]])
        

print("Fragility Index: ",frag_ind)
print("p-value",pvalue)
